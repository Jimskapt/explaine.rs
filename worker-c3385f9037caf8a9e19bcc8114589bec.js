(()=>{const e=()=>{};(async function(){e("workerMain");const n={source:null,session:null,explanation:null,exploration:null};function o(o){n.session&&(n.session.free(),n.session=null);const s=wasm_bindgen.Session.new(o),t=s.error_message(),a=s.error_location(),l=null!=t?{msg:t,start:{line:a[0]-1,ch:a[1]},end:{line:a[2]-1,ch:a[3]}}:null;n.session=s.session(),n.error=l,function o(s,t=!1){if(s!=n.session||null==n.session)return;t&&(n.exploration={buffer:new self.Uint32Array(40),result:[]});const{buffer:a,result:l}=n.exploration,r=n.session.explore(a,10);if(0===r)return e("Exploration finished..."),void postMessage({type:"exploration",exploration:n.exploration.result.map(e=>{const[n,o]=e;return{start:{line:n[0],ch:n[1]},end:{line:o[0],ch:o[1]}}})});for(let e=0;e<r;e++)n.exploration.result.push([[a[4*e]-1,a[4*e+1]],[a[4*e+2]-1,a[4*e+3]]]);setTimeout(()=>o(s))}(n.session,!0),postMessage({type:null!=n.session?"compiled":"compilation-error",error:n.error})}function s(e){a(e),postMessage({type:"explanation",location:l(n.explanation)})}function t(e){a(e),postMessage({type:"elaboration",location:l(n.explanation),elaboration:n.explanation&&n.explanation.elaborate(),title:n.explanation&&n.explanation.title(),book:n.explanation&&n.explanation.book(),keyword:n.explanation&&n.explanation.keyword()})}function a(e){n.explanation&&(n.explanation.free(),n.explanation=null),n.explanation=n.session&&n.session.explain(e.line+1,e.ch)}function l(e){return null!=e?{start:{line:e.start_line-1,ch:e.start_column},end:{line:e.end_line-1,ch:e.end_column}}:null}self.onmessage=n=>{const{data:a}=n;switch(e("Worker received",a.type),a.type){case"load":l=a.url,r=a.wasmUrl,self.importScripts(l),wasm_bindgen(r).then(()=>{postMessage({type:"ready"})},e=>console.error(e));break;case"compile":o(a.source);break;case"explain":s(a.location);break;case"elaborate":t(a.location);break;default:console.error("Unexpected message in worker",a)}var l,r}})().catch(e=>console.error(e))})();
