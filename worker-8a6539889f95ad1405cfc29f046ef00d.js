(()=>{const e=()=>{};(async function(){e("workerMain");const n={source:null,session:null,explanation:null,exploration:null};function o(o){n.session&&(n.session.free(),n.session=null);const s=wasm_bindgen.Session.new(o),l=s.error_message(),t=s.error_location(),a=null!=l?{msg:l,start:{line:t[0]-1,ch:t[1]},end:{line:t[2]-1,ch:t[3]},isBlock:s.is_block()}:null;n.session=s.session(),n.error=a,function o(s,l=!1){if(s!=n.session||null==n.session)return;l&&(n.exploration={buffer:new self.Uint32Array(40),result:[]});const{buffer:t,result:a}=n.exploration,i=n.session.explore(t,10);if(0===i)return e("Exploration finished..."),void postMessage({type:"exploration",exploration:n.exploration.result.map(e=>{const[n,o]=e;return{start:{line:n[0],ch:n[1]},end:{line:o[0],ch:o[1]}}})});for(let e=0;e<i;e++)n.exploration.result.push([[t[4*e]-1,t[4*e+1]],[t[4*e+2]-1,t[4*e+3]]]);setTimeout(()=>o(s))}(n.session,!0),postMessage({type:null!=n.session?"compiled":"compilation-error",error:n.error})}function s(e){t(e),postMessage({type:"explanation",location:a(n.explanation)})}function l(e){t(e),postMessage({type:"elaboration",location:a(n.explanation),elaboration:n.explanation&&n.explanation.elaborate(),title:n.explanation&&n.explanation.title(),book:n.explanation&&n.explanation.book(),keyword:n.explanation&&n.explanation.keyword()})}function t(e){n.explanation&&(n.explanation.free(),n.explanation=null),n.explanation=n.session&&n.session.explain(e.line+1,e.ch)}function a(e){return null!=e?{start:{line:e.start_line-1,ch:e.start_column},end:{line:e.end_line-1,ch:e.end_column}}:null}self.onmessage=n=>{const{data:t}=n;switch(e("Worker received",t.type),t.type){case"load":a=t.url,i=t.wasmUrl,self.importScripts(a),wasm_bindgen(i).then(()=>{postMessage({type:"ready"})},e=>console.error(e));break;case"compile":o(t.source);break;case"explain":s(t.location);break;case"elaborate":l(t.location);break;default:console.error("Unexpected message in worker",t)}var a,i}})().catch(e=>console.error(e))})();
